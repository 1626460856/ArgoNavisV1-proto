syntax = "proto3";

package Receipt;

import "google/api/annotations.proto";

option go_package = "Receipt/api/receipt/v1;receipt";


// =========================
// 创建收集表格式接口定义
// =========================
service Receipt {
  rpc GetReceiptStyle(GetReceiptStyleReq) returns (GetReceiptStyleResp) {
    option (google.api.http) = {
      get: "/receipt/check/teacher/style"
    };
  }
  rpc GetReceiptList(GetReceiptListReq) returns (GetReceiptListResp) {
    option (google.api.http) = {
      get: "/receipt/check/list"
    };
  }
  rpc GetReceiptDownloadUrl(GetReceiptDownloadUrlReq) returns (GetReceiptDownloadUrlResp) {
    option (google.api.http) = {
      get: "/receipt/check/list/download_url"
    };
  }
  rpc GetReceiptWriteSingle(GetReceiptWriteSingleReq) returns (GetReceiptWriteSingleResp) {
    option (google.api.http) = {
      get: "/receipt/check/Single"
    };
  }
  rpc CreateStyle(CreateStyleReq) returns (CreateStyleResp) {
    option (google.api.http) = {
      post: "/receipt/write/create/style"
      body: "*"
    };
  }
  rpc CreateReply(CreateReplyReq) returns (CreateReplyResp) {
    option (google.api.http) = {
      post: "/receipt/write/student/reply"
      body: "*"
    };
  }
  rpc ChangeReceiptReply(ChangeReceiptReplyReq) returns (ChangeReceiptReplyResp) {
    option (google.api.http) = {
      post: "/receipt/write/change/reply"
      body: "*"
    };
  }
}


message ReceiptStyleColumn {
  string receiptColumnName = 1;           // 单行收集栏标题
  int32 SingleOption = 2;                 // 是否为单选：1=是，0=否，默认1
  repeated string optionList = 3;         // 可选项栏，如["离校", "不离校"] 或 ["upload_file"]
}
//===

message ReceiptWriteColumn {
  string receiptColumnName = 1;                        // 对应老师格式单栏名称
  repeated string options = 2;                         // 学生选择的选项 / 填写内容 / 文件 URL
}

// =========================
// 获取收集表格式请求参数定义
// =========================
message GetReceiptStyleReq {
  string receipt_style_id = 1; // 收集表格式 ID
}

// =========================
// 获取收集表格式响应参数定义
// =========================
message GetReceiptStyleResp {
  int32 code = 1;                          // 状态码
  string msg = 2;                           // 返回消息
  repeated ReceiptStyleColumn receipt_style = 3;   // 收集表格式内容（字段名按你提供拼写）
}
// =========================




// =========================
// 获取收集表填写内容请求参数定义
// =========================
message GetReceiptListReq {
  int32 notice_id = 1; // 通知ID
}

// =========================
// 获取收集表填写内容响应参数定义
// =========================
message GetReceiptListResp {
  int32 code = 1; // 状态码
  string msg = 2; // 信息
  repeated ReceiptStyleColumn receipt_style = 3; // 教师设置的收集表样式
  repeated ReceiptWriteOne receipt_list = 4; // 所有学生填写内容
}

message ReceiptWriteOne{
  string student_id = 1;           // 学号
  string receipt_write_id = 2;     // 填写ID，用于后续打回
  string class = 3;                // 班级编号
  string student_name = 4;         // 学生姓名
  string write_time = 5;           // 填写时间（建议格式：ISO8601）
  repeated ReceiptWriteColumn receipt_write = 6; // 各个学生填写的每一项数据
}

// =========================

message GetReceiptDownloadUrlReq {
  int32 notice_id = 1; // 通知ID
}

message ReceiptWriteExcel {
  string receipt_write_excel_name = 1; // 文件名
  string receipt_write_excel_url = 2;  // 下载链接
}

message GetReceiptDownloadUrlResp {
  int32 code = 1; // 状态码
  string msg = 2; // 提示信息
  ReceiptWriteExcel receipt_write_excel = 3; // 下载信息对象
}


// 请求参数，传 receipt_write_id
message GetReceiptWriteSingleReq {
  string receipt_write_id = 1; // 收集表填写id，必填
}

// 响应参数
message GetReceiptWriteSingleResp {
  int32 code = 1;  // 状态码，比如200成功
  string msg = 2;  // 提示信息
  repeated ReceiptWriteColumn receipt_write = 3; // 填写详情列表，复用已有类型
}

// =========================
// 创建收集表格式请求参数
// =========================
message CreateStyleReq {
  repeated ReceiptStyleColumn receipt_style = 1; // 各行收集表格式汇总
}


// =========================
// 返回参数
// =========================
message CreateStyleResp {
  int32 code = 1;              // 响应码
  string msg = 2;              // 提示信息
  string receipt_style_id = 3; // 创建后的收集表格式ID
}



// ===============================
// 填收集表请求参数定义
// ===============================
message CreateReplyReq {
  int32 notice_id = 1;                                 // 通知 ID
  repeated ReceiptWriteColumn receipt_write = 2;             // 学生填写内容
}

// ===============================
// 返回参数定义
// ===============================
message CreateReplyResp {
  int32 code = 1;                                      // 状态码
  string msg = 2;                                      // 提示信息
  string receipt_write_id = 3;                         // 填写记录 ID（唯一标识）
}



// ========================
// 修改收集表填写内容请求参数定义
// ========================
message ChangeReceiptReplyReq {
  string receipt_write_id = 1; // 学生曾经填写的收集表 ID
  string receipt_style_id =2 ; // 收集表格式 ID
  repeated ReceiptWriteColumn receipt_write_change = 3; // 修改后的填写内容
}

// =========================
// 修改收集表填写内容响应参数定义
// =========================
message ChangeReceiptReplyResp {
  int32 code = 1;    // 返回状态码
  string msg = 2;    // 提示信息，如"修改成功"
}


